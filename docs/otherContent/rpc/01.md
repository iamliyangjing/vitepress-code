## 什么是RPC？

**RPC（Remote Procedure Call**即远程过程调用，通过名字我们就能看出PRC关注的是远程调用而非本地调用。



**为什么要RPC ？** 因为，两个不同的服务器上的服务提供的方法不在一个内存空间，所以，需要通过网络编程才能传递方法调用所需要的参数。并且，方法调用的结果也需要通过网络编程来接收。但是，如果我们自己手动网络编程来实现这个调用过程的话工作量是非常大的，因为，我们需要考虑底层传输方式（TCP 还是 UDP）、序列化方式等方面。



**RPC能帮助我们做什么呢？** 简单来说，通过RPC 可以帮助我们调用远程计算机上某个服务的方法，这个过程就像调用本地方法一样简单。并且！我们不需要了解底层网络编程的具体细节。



举个例子：两个不同的服务A、B部署在两台不同的机器上，服务A如果想要调用服务B中的某个方法的话可以通过RPC来做。

**RPC的作用就体现在这两个方面：**

- 屏蔽远程调用跟本地调用的区别，让我们感觉就是调用项目内的方法；
- 隐藏底层网络通信的复杂性，让我们更专注于业务逻辑。

一句话：**RPC的出现就是为了让你调用远程方法像调用本地方法一样简单。**



## RPC原理是什么？

1. **客户端（服务消费端）**： 调用远程方法的一端
2. **客户端Stub （桩）**：这其实就是一代理类，代理类主要做的事情很简单，就是把你调用方法、类、方法参数等信息传递带服务端。
3. **网络传输** ：网络传输就是你要把你调用的方法的信息比如说参数啊这些东西传输到服务端，然后服务端执行完之后再把返回结果通过网络传输给你传输回来。网络传输的实现方式有很多种比如最基本的Socket或者性能以及封装更加优秀的Netty（推荐）。
4. **服务器 Stub(桩)**： **这个桩就不是代理类了**。我觉得理解为桩实际不太好，大家注意一下就好。这里的服务端Stub实际指的就是接收到客户端执行方法的请求后，去指定对应的方法然后返回结果给客户端的类。
5. **服务端（服务提供端）**： 提供远程方法的一端。

![image-20230108201653471](markdown-img/01.assets/image-20230108201653471.png)

1. 服务消费端（client） 以本地调用的方式调用远程服务；
2. 客户端 Stub （client stub）接收到调用后负责将方法、参数等组装成能够进行网络传输的消息体（序列化）：RpcRequest；
3. 客户端 Stub（client stub）找到远程服务的地址，并将消息发送到服务提供端：**RpcRequest**
4. 服务端 Stub（桩）收到消息将消息反序列化为 Java对象：**RpcRequest**；
5. 服务端Stub (桩) 根据 **RpcRequest** 中的类、方法、方法参数等信息调用本地的方法;
6. 服务端Stub(桩)得到方法执行结果并将组装成能够进行网络传输的消息体 :  **RpcResponse** (序列化) 发送至消费方;
7. 客户端stub (client stub)接收到消息并将消息反序列化为Java对象:**RpcResponse** ，这样也就得到了最终结果。over!



## RPC在架构中的位置

围绕 RPC 我们讲了这么多，那 RPC 在架构中究竟处于什么位置呢？

如刚才所讲，**RPC是解决应用间通信的一种方式**，而无论是在一个大型的分布式应用系统还是中小型系统中，应用架构最终都会从“单体”演进程 “微服务化”，整个应用系统会被拆分为多个不同功能的应用，并将他们部署在不同的服务器中，而应用之间通过RPC进行通信，可以说RPC对应的是整个分布式应用系统，就像是“经络”一样的存在。

**<font color='red'>那么如果没有RPC，我们现实中开发过程是怎样的一个体验呢？</font>**

**所有的功能代码都会被我们堆砌在一个大项目中，开发过程中你可能要改一行代码，但改完后编译会花掉你⒉分钟，编译完想运行起来验证下结果可能要5分钟**，是不是很酸爽?更难受的是在人数比较多的团队里面，多人协同开发的时候，如果团队其他人把接口定义改了，你连编译通过的机会都没有，系统直接报错，从而导致整个团队的开发效率都会非常低下。而且当我们准备要上线发版本的时候，QA 也很难评估这次的测试范围，为了保险起见我们只能把所有的功能进行回归测试，这样会导致我们上线新功能的整体周期都特别长。

无论是谁都无法接受这种系统架构，那么怎么才能解决这个问题呢？

我们首先都会想到可以采用 “分而治之” 的思想来进行拆分，但是拆分完的系统怎么保持跟未拆分前的调用方式一样呢？ 我们总不能因为架构升级，就把所有的代码都推倒重写一遍吧。

**<font color='red'>RPC框架能够帮助我们解决系统拆分后的通信问题，并且能让我们像调用本地一样去调用远程方法。</font>**
